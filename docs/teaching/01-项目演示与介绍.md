# 教案1：项目演示与介绍

> 目的：让学生了解项目全貌，理解 AI 创作平台能做什么

---

## 一、项目定位与价值

### 我们在做什么

**全模态 AI 创作平台** —— 用户输入一句话，系统自动理解意图、选择合适的 AI 模型、优化提示词，生成图片/视频/音频。

核心理念：**用户不需要懂 AI，只需要描述需求。**

### 解决什么问题

传统方式：用户需要选择模型 → 选择参数 → 手写英文提示词 → 等待 → 不满意再调

我们的方式：**用户说中文** → Agent 自动搞定一切

### 类比理解

把系统想象成一个"AI 创意总监"：
- 你说："帮我画一只在星空下跳舞的猫，要竖屏的"
- AI 总监听懂了：哦，要图片，竖屏 9:16，主题是猫 + 星空 + 跳舞
- 选模型：Gemini，够快够好
- 优化提示词：加上 "high quality, detailed" 等专业修饰
- 交给画师（Provider）执行

---

## 二、核心功能演示

### 演示1：文生图

**操作**：在创作工作台输入"一只猫在星空下跳舞，油画风格"

**关键观察点**：
- Agent 自动识别：contentType = IMAGE，intent = text_to_image
- 自动选模型：gemini-2.5-flash-image
- 自动增强提示词：加上 ", high quality, detailed"
- 返回 taskId，前端开始轮询
- 约 10-30 秒后图片生成完成

### 演示2：文生视频

**操作**：输入"一只猫在月光下散步，竖屏短视频，5秒"

**关键观察点**：
- Agent 识别：contentType = VIDEO，intent = text_to_video
- 参数提取：aspectRatio=9:16（竖屏），duration=6（就近取值），quality=standard
- 选模型：veo-3.1-fast-generate-preview
- 使用 `predictLongRunning` 异步 API，内部每 10 秒轮询，可能需要 1-3 分钟

### 演示3：语音合成（TTS）

**操作**：输入"用温柔的女声朗读：在很久很久以前，有一座神秘的森林..."

**关键观察点**：
- Agent 识别：contentType = AUDIO，intent = text_to_audio
- 语音选择：检测到"温柔"+"女声" → 选择 Aoede 语音
- 使用 gemini-2.5-flash-preview-tts 模型

### 演示4：图生图

**操作**：上传一张图片 + 输入"把这张照片变成水彩画风格"

**关键观察点**：
- Agent 检测到有参考图片 → 自动调整 intent 为 image_to_image
- 提示词增强：加上 "maintain the original composition and style"
- 图片数据以 base64 传入 Gemini API

### 演示5：图生视频

**操作**：上传一张风景照 + 输入"让这张照片动起来"

**关键观察点**：
- Agent 识别有参考图片 + 内容类型为 VIDEO → intent = image_to_video
- 构建 Veo `predictLongRunning` 请求时，instance 中包含 image 字段
- 视频将基于图片内容生成动态效果

### 演示6：灵感广场

**操作**：切换到灵感广场页面

**功能展示**：
- 展示提示词卡片库
- 支持一键复制提示词到创作工作台
- 支持"一键使用"直接跳转创作

### 演示7：我的资产

**操作**：切换到我的资产页面

**功能展示**：
- 查看生成历史（图片/视频/音频分类）
- 预览、删除操作
- 作品发布到灵感广场

---

## 三、整体架构全貌

```
┌─────────────────────────────────────────────────────────────────┐
│                        前端 (Vue 3 + Vite)                       │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │  创作工作台    │  │  灵感广场     │  │  我的资产     │          │
│  └──────┬───────┘  └──────────────┘  └──────────────┘          │
│         │ POST /api/aigc/generate                               │
│         │ GET  /api/aigc/task/{id}  ← 轮询(1秒/次, 最多180次)   │
└─────────┼───────────────────────────────────────────────────────┘
          ↓
┌─────────────────────────────────────────────────────────────────┐
│                    后端 (Spring Boot 3.4.5)                      │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                 1️⃣ 智能路由 Agent (核心)                    │  │
│  │  IntentAnalyzer  →  RoutingAgent  →  PromptEnhancer       │  │
│  │  (OneRouter LLM)    (路由决策)       (提示词优化)           │  │
│  └────────────────────────────────────────────────────────────┘  │
│                              ↓                                   │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │               2️⃣ ProviderRouter (提供商路由)               │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │  │
│  │  │ Google Image │  │ Google Video│  │ Google Audio │       │  │
│  │  │  (Gemini)    │  │   (Veo)     │  │   (TTS)     │       │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘       │  │
│  └────────────────────────────────────────────────────────────┘  │
│                              ↓                                   │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │               3️⃣ 异步任务管理                              │  │
│  │  @Async → 创建任务 → 执行生成 → 保存资产 → 更新状态        │  │
│  │  数据库: AigcTask + AigcAsset (JPA)                        │  │
│  └────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 四、技术栈说明

### 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Spring Boot | 3.4.5 | 基础框架 |
| JDK | 17 | 语言版本（用到 switch表达式、文本块、record 等新特性）|
| Spring Data JPA | - | ORM，自动建表 |
| OkHttp | - | 调用 Google API（比 RestTemplate 更灵活）|
| RestTemplate | - | 调用 OneRouter API |
| Druid | - | 数据库连接池 + 监控 |
| Redis + Lettuce | - | 缓存 |

### 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.5 | 框架 |
| Vite | 7 | 构建工具 |
| TypeScript | 5.6 | 类型安全 |
| Element Plus | 2.11 | UI 组件库 |
| Axios | 1.12 | HTTP 请求 |
| Pinia | 3.0 | 状态管理 |
| TailwindCSS | 4.1 | 样式 |

### AI 模型

| 模型 | 提供商 | 用途 | 特点 |
|------|--------|------|------|
| gpt-4o-mini | OneRouter | Agent 意图分析 | 便宜($0.15/1M tokens)，用于理解用户意图 |
| gemini-2.5-flash-image | Google | 图片生成（默认）| 快速高效，1024px |
| gemini-3-pro-image-preview | Google | 图片生成（高清）| 支持 2K/4K 分辨率 |
| veo-3.1-fast-generate-preview | Google | 视频生成（快速）| $0.15/秒，含音频 |
| veo-3.1-generate-preview | Google | 视频生成（标准）| $0.40/秒，高质量 |
| gemini-2.5-flash-preview-tts | Google | 语音合成 | 5种预设语音 |

### 成本优化策略

关键设计：**意图分析用便宜的 LLM，内容生成才用贵的模型**

```
用户请求 → gpt-4o-mini 分析意图 ($0.15/1M tokens) 
        → 确定类型后 → Google GenAI 生成内容 (按需计费)
```

这样每次请求的意图分析成本几乎可以忽略不计。
